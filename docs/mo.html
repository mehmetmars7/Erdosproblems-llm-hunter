<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6MVZPMS7X5"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-6MVZPMS7X5');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathOverflow Problems - Problem Hunting with LLMs (beta)</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                tags: 'ams',
                macros: {
                    'R': '{\\mathbb{R}}',
                    'C': '{\\mathbb{C}}',
                    'N': '{\\mathbb{N}}',
                    'Z': '{\\mathbb{Z}}',
                    'Q': '{\\mathbb{Q}}'
                }
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header>
        <h1>MathOverflow Problems</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="erdos.html">Erdos Problems</a>
            <a href="mo.html" class="active">MathOverflow</a>
            <a href="about.html">About</a>
        </nav>
    </header>

    <main>
        <section class="description">
            <p>
                Open problems from <a href="https://mathoverflow.net/">MathOverflow</a>,
                a question and answer site for professional mathematicians.
            </p>
        </section>

        <section class="filters">
            <label for="filter-attacks">
                <input type="checkbox" id="filter-attacks" checked>
                Only show problems with LLM attempts
            </label>
            <label for="search">
                Search: <input type="text" id="search" placeholder="Title or ID...">
            </label>
        </section>

        <section class="problems-list">
            <table id="mo-table">
                <thead>
                    <tr>
                        <th>Question</th>
                        <th>Score</th>
                        <th id="claim-header" style="cursor: pointer;" title="Click to sort by status">LLM Claim â‡…</th>
                        <th>Models</th>
                        <th>Link</th>
                    </tr>
                </thead>
                <tbody id="mo-tbody">
                    <tr><td colspan="5">Loading...</td></tr>
                </tbody>
            </table>
        </section>

        <section class="contribute-cta">
            <h3>Contribute</h3>
            <p>
                Have an LLM attempt to share for a MathOverflow problem?
                See our <a href="https://github.com/mehmetmars7/Erdosproblems-llm-hunter/blob/main/CONTRIBUTING.md" target="_blank">Contributing Guidelines</a>
                to submit your contribution.
            </p>
        </section>
    </main>

    <footer>
        <p>
            <a href="https://github.com/mehmetmars7/Erdosproblems-llm-hunter">GitHub Repository</a> |
            <a href="about.html">About</a> |
            <a href="LICENSE">Apache License 2.0</a>
        </p>
    </footer>

    <script src="data/mo_data.js"></script>
    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tbody = document.getElementById('mo-tbody');
            const filterCheckbox = document.getElementById('filter-attacks');
            const searchInput = document.getElementById('search');
            const claimHeader = document.getElementById('claim-header');
            let sortByStatus = 0; // 0 = by score, 1 = status A-Z, -1 = status Z-A
            
            const hasUnresolved = (attack) => /unresolved/i.test(attack.raw || '');

            // Helper to determine overall status
            const getOverallStatus = (attacks) => {
                if (!attacks || attacks.length === 0) return 'zzz-none'; // Sort last
                return attacks.some(hasUnresolved) ? 'unresolved' : 'solved';
            };

            function renderTable() {
                if (typeof moProblems === 'undefined') {
                    tbody.innerHTML = '<tr><td colspan="5">Error loading data</td></tr>';
                    return;
                }

                const filterAttacks = filterCheckbox.checked;
                const searchTerm = searchInput.value.trim().toLowerCase();

                let problems = Object.values(moProblems);

                // Sort by score descending or status
                if (sortByStatus !== 0) {
                    problems.sort((a, b) => {
                        const statusA = getOverallStatus(a.attacks);
                        const statusB = getOverallStatus(b.attacks);
                        return sortByStatus * statusA.localeCompare(statusB);
                    });
                } else {
                    problems.sort((a, b) => b.score - a.score);
                }

                // Filter
                if (filterAttacks) {
                    problems = problems.filter(p => p.attacks && p.attacks.length > 0);
                }
                if (searchTerm) {
                    problems = problems.filter(p =>
                        p.id.includes(searchTerm) ||
                        (p.title && p.title.toLowerCase().includes(searchTerm))
                    );
                }

                if (problems.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5">No problems found</td></tr>';
                    return;
                }

                tbody.innerHTML = problems.map(p => {
                    // Shorten model names and limit to 2, prioritizing GPT Pro
                    const shortenModel = (name) => {
                        if (name.toLowerCase().includes('gpt pro')) return 'GPT Pro';
                        if (name.toLowerCase().includes('gpt 5.2') || name.toLowerCase().includes('gpt_5.2')) return 'GPT 5.2';
                        if (name.toLowerCase().includes('codex')) return 'Codex';
                        if (name.toLowerCase().includes('claude') || name.toLowerCase().includes('opus')) return 'Opus 4.5';
                        if (name.toLowerCase().includes('gemini')) return 'Gemini';
                        return name.split(' ').slice(0, 2).join(' ');
                    };
                    let uniqueModels = [...new Set(p.attacks.map(a => shortenModel(a.model)))];
                    // Prioritize GPT Pro - if present, put it first
                    if (uniqueModels.includes('GPT Pro')) {
                        uniqueModels = ['GPT Pro', ...uniqueModels.filter(m => m !== 'GPT Pro')];
                    }
                    const models = uniqueModels.slice(0, 2).join(', ') || '-';
                    // Decode HTML entities in title
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = p.title || `Question ${p.id}`;
                    const title = tempDiv.textContent || tempDiv.innerText || `Question ${p.id}`;
                    
                    // Determine overall status based on the source content.
                    const determineStatus = (attacks) => {
                        if (!attacks || attacks.length === 0) return 'None';
                        return attacks.some(hasUnresolved) ? 'Unresolved' : 'Solved';
                    };
                    
                    const status = determineStatus(p.attacks);
                    const statusClass = status === 'Solved' ? 'table-status-solved' :
                                       status === 'Unresolved' ? 'table-status-unresolved' :
                                       '';

                    return `
                        <tr>
                            <td><a href="problem.html?type=mo&id=${p.id}">${title}</a></td>
                            <td>${p.score}</td>
                            <td class="${statusClass}">${status}</td>
                            <td>${models}</td>
                            <td><a href="${p.link}" target="_blank">MathOverflow</a></td>
                        </tr>
                    `;
                }).join('');
                
                // Trigger MathJax to render any TeX in titles
                if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                    MathJax.typesetPromise([tbody]).catch(err => console.warn('MathJax error:', err));
                }
            }

            // Use debounce from app.js for search input
            const debouncedRender = window.ProblemHunting.debounce(renderTable, 200);

            filterCheckbox.addEventListener('change', renderTable);
            searchInput.addEventListener('input', debouncedRender);
            claimHeader.addEventListener('click', () => {
                // Cycle: default (0) -> A-Z (1) -> Z-A (-1) -> default (0)
                if (sortByStatus === 0) {
                    sortByStatus = 1;
                } else if (sortByStatus === 1) {
                    sortByStatus = -1;
                } else {
                    sortByStatus = 0;
                }
                renderTable();
            });
            renderTable();
        });
    </script>
</body>
</html>
